; ====================================================================
; CONFIGURATION DU PROJET PLATFORMIO
; Ce fichier configure les paramètres de construction, de téléchargement et de
; surveillance pour le projet PlatformIO, optimisé pour l'ESP32-S3 DevKitC-1 N16R8.
; ====================================================================

[env:esp32-s3-devkitc-1]

; --------------------------------------------------------------------
; 1. PARAMÈTRES DE BASE DE LA CARTE, DU FRAMEWORK ET DU MONITEUR
; --------------------------------------------------------------------
platform = espressif32                   ; Spécifie le framework Espressif (plateforme).
board = esp32-s3-devkitc-1               ; Définit le modèle exact de la carte (DevKitC-1).
framework = arduino                      ; Utilise le framework Arduino.
monitor_speed = 115200                   ; Vitesse de communication du moniteur série pour le débogage.
upload_speed = 921600                    ; Vitesse de téléchargement vers la carte (plus rapide que la valeur par défaut de 460800).
monitor_filters = esp32_exception_decoder; Ajoute le filtre pour décoder les traces d'exceptions ESP32 (utile pour le débogage).

; --------------------------------------------------------------------
; 2. CONFIGURATION DE LA MÉMOIRE (FLASH 16MB et PSRAM 8MB - N16R8)
; Ces options sont cruciales pour exploiter toute la capacité de la carte.
; --------------------------------------------------------------------
board_build.flash_mode = qio             ; Mode de communication pour la mémoire Flash (Quad I/O).
board_upload.flash_size = 16MB           ; Indique la taille réelle de la Flash (16 Mégabytes).
board_build.partitions = default_16MB.csv  ; Table de partitions adaptée pour une Flash de 16MB.
board_build.filesystem = spiffs          ; Active SPIFFS par défaut (peut être remplacé par littlefs).
board_build.arduino.memory_type = qio_opi ; Type de mémoire Flash pour l'Arduino Core (techniquement optionnel, mais explicite).

; Configuration PSRAM (8MB)
board_build.arduino.psram = opi          ; Active l'utilisation de la PSRAM intégrée (mode OPI = Octal-SPI).
board_build.psram_type = opi             ; Confirme le type de PSRAM comme OPI.

; --------------------------------------------------------------------
; 3. DRAPEAUX DE CONSTRUCTION (Build Flags) et Optimisations IDF
; Ces drapeaux définissent les macros et options de compilation du compilateur.
; --------------------------------------------------------------------
build_flags = 
	-std=gnu++17                         ; Active le support du C++17 (conseillé).
	-D BOARD_HAS_PSRAM                   ; Macro pour indiquer au code Arduino l'existence de la PSRAM.
	
	; ----------------------------------------------------------------
	; OPTIONS DE DÉBOGAGE USB (À COMMENTER QUAND LE DÉBOGAGE N'EST PLUS NÉCESSAIRE)
	; Mettre ces lignes en commentaire permet de réduire la taille du firmware
	; et d'économiser de la mémoire/des ressources.
	; ----------------------------------------------------------------
	-D ARDUINO_USB_CDC_ON_BOOT=1         ; Active le port série USB (CDC) au démarrage.
	-D ARDUINO_USB_MODE=1                ; Active le mode USB (l'équivalent du paramètre 'board_build.usb_mode = 1').

	; Flags IDF pour l'optimisation de la PSRAM (mode OPI à 80MHz)
	-DCONFIG_IDF_TARGET_ESP32S3          ; Définit la cible IDF (Espressif IoT Development Framework).
	-DCONFIG_SPIRAM_MODE_OCT=1           ; Assure que la PSRAM est configurée en mode Octal (OPI).
	-DCONFIG_SPIRAM_SPEED_80M=1          ; Définit la vitesse d'accès à la PSRAM à 80MHz pour de meilleures performances.

	; ----------------------------------------------------------------
	; CONFIGURATION DU WATCHDOG TIMER (WDT)
	; Utilisé pour surveiller les tâches et redémarrer la carte en cas de blocage.
	; ----------------------------------------------------------------
	-DCONFIG_ESP_TASK_WDT_TIMEOUT_S=10   ; Définit le délai d'expiration du Watchdog à 10 secondes.
	-DCONFIG_ESP_TASK_WDT_PANIC=0        ; Désactive le panic mode sur expiration (permet un redémarrage normal).
	-DCONFIG_ESP_TASK_WDT_CHECK_IDLE_TASK_CPU0=0 ; Désactive la surveillance de la tâche Idle (inoccupée) sur le CPU0.
	-DCONFIG_ESP_TASK_WDT_CHECK_IDLE_TASK_CPU1=0 ; Désactive la surveillance de la tâche Idle (inoccupée) sur le CPU1.

	; ----------------------------------------------------------------
	; CONFIGURATION WIFI & RÉSEAU (LWIP)
	; Ajuste les capacités réseau du système d'exploitation embarqué (max sockets).
	; ----------------------------------------------------------------
	-DCONFIG_LWIP_MAX_SOCKETS=10         ; Définit le nombre maximum de sockets simultanés à 10.
	-DCONFIG_LWIP_SO_REUSE=1             ; Active la réutilisation des adresses de socket.
	-DCONFIG_LWIP_SO_REUSE_RXTOALL=1     ; Active la réutilisation de socket pour la réception (Broadcast).

	; ----------------------------------------------------------------
	; CONFIGURATION FREERTOS
	; Ajuste le système d'exploitation temps réel utilisé par l'IDF.
	; ----------------------------------------------------------------
	-DCONFIG_FREERTOS_UNICORE=0          ; Désactive le mode mono-cœur (force le mode double cœur, par défaut sur l'ESP32-S3).
	-DCONFIG_FREERTOS_HZ=1000            ; Définit la fréquence du Tick de FreeRTOS à 1000 Hz (précision accrue).

build_unflags = -std=gnu++11             ; Supprime l'ancien standard C++11 par défaut, en faveur de C++17.

; --------------------------------------------------------------------
; 4. DÉPENDANCES DES LIBRAIRIES
; Librairies externes requises par le projet.
; --------------------------------------------------------------------
lib_deps =
	; Librairies OLED (Adafruit + U8g2)
	adafruit/Adafruit SSD1306 @ ^2.5.1   ; Librairie populaire pour écrans OLED SSD1306.
	adafruit/Adafruit GFX Library @ ^1.10.10 ; Librairie graphique de base requise par SSD1306.
	olikraus/U8g2 @ ^2.36.15             ; Librairie graphique alternative et très optimisée.
	
	; Autres capteurs et périphériques
	adafruit/Adafruit NeoPixel@1.12.0    ; Gestion des LEDs adressables NeoPixel (WS2812).
	adafruit/DHT sensor library@^1.4.4   ; Support pour les capteurs d'humidité et de température DHT.
	adafruit/Adafruit BusIO @ ^1.15.0    ; Librairie de bas niveau pour la gestion des bus I2C/SPI (dépendance).

; --------------------------------------------------------------------
; 5. CONFIGURATION GÉNÉRALE PLATFORMIO
; Paramètres généraux pour PlatformIO.
; --------------------------------------------------------------------
[platformio]
; Utilisation de chemins absolus pour éviter les problèmes de chemins longs (Windows)
build_dir = C:/pio_builds/myproj_build   ; Chemin absolu pour le répertoire de construction.
build_cache_dir = C:/pio_builds/myproj_cache ; Chemin absolu pour le répertoire de cache.